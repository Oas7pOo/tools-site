---
layout: default
title: 文本转01字符串 - 冰兔的工具站
header_title: 文本转01字符串
header_description: 将文本（中英符号均可）转为01二进制字符串或条形码，或上传条码图片/01串直接还原为原文
---

<h2>文本转条码/01字符串工具</h2>
<div class="container">
    <label for="txtInput">请输入文本内容（支持中文、英文、数字、符号等）：</label>
    <textarea id="txtInput" rows="4" style="width: 100%;"></textarea>
    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
      <button onclick="convertToBin()" class="disable-on-click">转换为01字符串</button>
      <button onclick="showBarcodeFromText()" class="disable-on-click">将文字转换为条形码</button>
      <button id="downloadBarcodeBtn" style="display:none;">下载条形码PNG</button>
    </div>
    <label for="binOutput" style="margin-top:15px;">转换结果（每8位一组）：</label>
    <textarea id="binOutput" rows="4" style="width: 100%;" readonly></textarea>
    <div id="barcodeArea" style="margin-top:18px;">
        <label style="display:block;">条形码预览：</label>
        <svg id="barcodeSvg"></svg>
        <canvas id="barcodeCanvas" width="360" height="90" style="display:none;"></canvas>
    </div>
</div>

<hr>
<h2>上传条形码图片/输入01字符串还原文本</h2>
<div class="container">
    <label for="inputArea">请输入<b>01字符串</b>或<b>条形码Base64内容</b>：</label>
    <textarea id="inputArea" rows="4" style="width: 100%;"></textarea>
    <button onclick="convertInputToText()" class="disable-on-click" style="margin-top:10px;">还原为原文</button>
    <label style="display:block;margin:15px 0 5px 0;">或上传png图片文件：</label>
    <input type="file" id="imageInput" accept=".png,.jpg,.jpeg,.webp">
    <button onclick="decodeBarcodeImage()" class="disable-on-click" style="margin-top:10px;">读取图片条形码并还原为原文</button>
    <label for="textOutput" style="margin-top:15px;">还原结果：</label>
    <textarea id="textOutput" rows="4" style="width: 100%;" readonly></textarea>
</div>

<!-- 通用工具函数 -->
<script src="../js/common.js"></script>
<script>
    // common对象降级处理
    if (typeof window.common === 'undefined') {
        window.common = {
            showLoadingIndicator: function(button) {
                if (button) {
                    const originalText = button.innerText;
                    button.disabled = true;
                    return originalText;
                }
                return '';
            },
            hideLoadingIndicator: function(button, originalText) {
                if (button) {
                    button.disabled = false;
                    button.innerText = originalText;
                }
            },
            showNotification: function(message, type) {
                // 降级为alert
                alert(message);
            }
        };
    }
</script>
<!-- JsBarcode 条码生成库 -->
<script src="../js/JsBarcode.all.min.js"></script>
<!-- ZXing-js 条码识别库 -->
<script src="../js/zxing-js.umd.min.js"></script>
<script>
// 降级处理：确保common对象存在
if (typeof window.common === 'undefined') {
    window.common = {
        showNotification: function(message, type) {
            type = type || 'info';
            console.log('[' + type + ']', message);
            alert(message);
        },
        showLoadingIndicator: function(button) {
            if (button) {
                button.disabled = true;
                const originalText = button.innerText;
                button.setAttribute('data-original-text', originalText);
                button.innerText = '处理中...';
                return originalText;
            }
            return '';
        },
        hideLoadingIndicator: function(button, originalText) {
            if (button) {
                button.disabled = false;
                if (originalText) {
                    button.innerText = originalText;
                }
            }
        }
    };
}

// 文本转01字符串
window.convertToBin = function() {
    const text = document.getElementById('txtInput').value;
    if (!text) {
        document.getElementById('binOutput').value = '';
        return;
    }
    
    try {
        const encoder = new TextEncoder();
        const bytes = encoder.encode(text);
        let arr = [];
        for (let byte of bytes) {
            arr.push(byte.toString(2).padStart(8, '0'));
        }
        document.getElementById('binOutput').value = arr.join(' ');
    } catch (e) {
        common.showNotification('转换失败: ' + e.message, 'error');
    }
}

// 二进制字符串 → Base64
function binToBase64(binStr) {
    binStr = binStr.replace(/\s+/g, '');
    if (binStr.length % 8 !== 0) binStr = binStr.padEnd(Math.ceil(binStr.length/8)*8, '0');
    let bytes = [];
    for (let i = 0; i < binStr.length; i += 8) {
        bytes.push(parseInt(binStr.substr(i, 8), 2));
    }
    let uint8 = new Uint8Array(bytes);
    let binStrRaw = '';
    for (let i = 0; i < uint8.length; i++) binStrRaw += String.fromCharCode(uint8[i]);
    return btoa(binStrRaw);
}

// Base64 → 二进制字符串
function base64ToBin(base64) {
    try {
        let str = atob(base64.trim());
        let arr = [];
        for (let i = 0; i < str.length; i++) {
            arr.push(str.charCodeAt(i).toString(2).padStart(8, '0'));
        }
        return arr.join(' ');
    } catch(e) {
        return '';
    }
}

// 用原始文本生成条形码（内容为Base64，底部显示原文）并支持PNG下载
window.showBarcodeFromText = function() {
    const button = document.querySelector('button[onclick="showBarcodeFromText()"]');
    const originalText = common.showLoadingIndicator(button);
    
    try {
        const text = document.getElementById('txtInput').value;
        const svg = document.getElementById('barcodeSvg');
        const canvas = document.getElementById('barcodeCanvas');
        const downloadBtn = document.getElementById('downloadBarcodeBtn');
        
        if (!text) {
            svg.innerHTML = '';
            downloadBtn.style.display = 'none';
            common.showNotification('请先输入文本内容', 'warning');
            return;
        }
        
        // 转成01，再Base64压缩
        const encoder = new TextEncoder();
        const bytes = encoder.encode(text);
        let binStr = '';
        for (let byte of bytes) binStr += byte.toString(2).padStart(8, '0');
        let base64 = binToBase64(binStr);

        // 绘制到SVG
        JsBarcode(svg, base64, {
            format: "CODE128",
            lineColor: "#222",
            width: 2,
            height: 60,
            displayValue: true,
            text: text,
            fontSize: 18,
            textMargin: 8,
            margin: 10,
        });
        
        // SVG转Canvas再转PNG，供下载
        const xml = new XMLSerializer().serializeToString(svg);
        const DOMURL = window.URL || window.webkitURL || window;
        const img = new window.Image();
        const svgBlob = new Blob([xml], {type: 'image/svg+xml;charset=utf-8'});
        const url = DOMURL.createObjectURL(svgBlob);

        img.onload = function() {
            try {
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                
                // 生成PNG并绑定下载
                canvas.toBlob(function(blob) {
                    downloadBtn.style.display = '';
                    downloadBtn.onclick = function() {
                        // 优先使用common.js的downloadFile函数
                        if (typeof common.downloadFile === 'function') {
                            common.downloadFile(blob, 'barcode.png', 'image/png');
                        } else {
                            // 降级方案
                            const a = document.createElement('a');
                            const url2 = URL.createObjectURL(blob);
                            a.href = url2;
                            a.download = 'barcode.png';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            setTimeout(()=>URL.revokeObjectURL(url2), 2000);
                        }
                    };
                    common.hideLoadingIndicator(button, originalText);
                });
                DOMURL.revokeObjectURL(url);
            } catch (e) {
                common.showNotification('条形码渲染失败: ' + e.message, 'error');
                common.hideLoadingIndicator(button, originalText);
            }
        };
        
        img.onerror = function() {
            common.showNotification('图片加载失败', 'error');
            downloadBtn.style.display = 'none';
            common.hideLoadingIndicator(button, originalText);
        };
        
        img.src = url;
    } catch (e) {
        svg.innerHTML = '<text x="10" y="40" fill="red">条形码生成失败</text>';
        downloadBtn.style.display = 'none';
        common.showNotification('条形码生成失败: ' + e.message, 'error');
        common.hideLoadingIndicator(button, originalText);
    }
}

// 01字符串/Base64 → 原文
window.convertInputToText = function() {
    const button = document.querySelector('button[onclick="convertInputToText()"]');
    const originalText = common.showLoadingIndicator(button);
    
    try {
        let input = document.getElementById('inputArea').value.trim();
        const out = document.getElementById('textOutput');
        
        if (!input) {
            out.value = '';
            common.hideLoadingIndicator(button, originalText);
            return;
        }
        
        // 先判断是不是01串
        let binStr = '';
        if (/^[01\s]+$/.test(input) && input.replace(/\s/g,'').length % 8 === 0) {
            // 01字符串
            binStr = input.replace(/\s+/g, '');
        } else {
            // 尝试Base64
            binStr = base64ToBin(input);
            if (!binStr) {
                out.value = '输入内容格式不正确，无法还原。';
                common.showNotification('输入内容格式不正确，无法还原。', 'warning');
                common.hideLoadingIndicator(button, originalText);
                return;
            }
        }
        
        try {
            let bytes = [];
            for (let i = 0; i < binStr.length; i += 8) {
                bytes.push(parseInt(binStr.substr(i, 8), 2));
            }
            const arr = new Uint8Array(bytes);
            const decoder = new TextDecoder();
            const output = decoder.decode(arr);
            out.value = output;
            common.showNotification('解码成功', 'success');
        } catch (e) {
            out.value = '解码失败：输入内容可能有误。';
            common.showNotification('解码失败：输入内容可能有误。', 'error');
        }
    } catch (e) {
        document.getElementById('textOutput').value = '处理过程中发生错误。';
        common.showNotification('处理过程中发生错误：' + e.message, 'error');
    } finally {
        common.hideLoadingIndicator(button, originalText);
    }
}

// 上传图片条形码 → 还原为原文（自动Base64/01两种方式还原）
window.decodeBarcodeImage = function() {
    const input = document.getElementById('imageInput');
    const out = document.getElementById('textOutput');
    out.value = '';
    
    // 获取调用此函数的按钮
    const button = document.querySelector('button[onclick="decodeBarcodeImage()"]');
    const originalText = common.showLoadingIndicator(button);
    
    try {
        if (!input.files.length) {
            common.showNotification('请上传图片', 'warning');
            common.hideLoadingIndicator(button, originalText);
            return;
        }
        
        const file = input.files[0];
        const imgURL = URL.createObjectURL(file);
        const img = new window.Image();
        
        img.onload = function() {
            try {
                const codeReader = new ZXing.BrowserBarcodeReader();
                codeReader.decodeFromImageElement(img).then(result => {
                    try {
                        let codeText = result.text.trim();
                        // 先尝试base64方式还原
                        let originText = tryBase64ToUtf8(codeText);
                        if (originText !== null) {
                            out.value = originText;
                            common.showNotification('条码解码成功', 'success');
                        } else if (/^[01\s]+$/.test(codeText) && codeText.replace(/\s/g,'').length % 8 === 0) {
                            // 若条码内容为 01串，则先转byte再转文本
                            out.value = binToText(codeText);
                            common.showNotification('条码解码成功', 'success');
                        } else {
                            out.value = codeText; // 直接输出
                            common.showNotification('条码识别成功，内容已显示', 'success');
                        }
                    } catch (e) {
                        out.value = "处理条码内容时发生错误。";
                        common.showNotification('处理条码内容时发生错误：' + e.message, 'error');
                    } finally {
                        // 释放资源
                        URL.revokeObjectURL(imgURL);
                        common.hideLoadingIndicator(button, originalText);
                    }
                }).catch(err => {
                    out.value = "条码识别失败：" + (err && err.message ? err.message : err);
                    common.showNotification('条码识别失败：' + (err && err.message ? err.message : err), 'error');
                    URL.revokeObjectURL(imgURL);
                    common.hideLoadingIndicator(button, originalText);
                });
            } catch (e) {
                out.value = "条码识别过程中发生错误。";
                common.showNotification('条码识别过程中发生错误：' + e.message, 'error');
                URL.revokeObjectURL(imgURL);
                common.hideLoadingIndicator(button, originalText);
            }
        };
        
        img.onerror = function() {
            out.value = "图片加载失败。";
            common.showNotification('图片加载失败', 'error');
            URL.revokeObjectURL(imgURL);
            common.hideLoadingIndicator(button, originalText);
        };
        
        img.src = imgURL;
    } catch (e) {
        out.value = "处理过程中发生错误。";
        common.showNotification('处理过程中发生错误：' + e.message, 'error');
        common.hideLoadingIndicator(button, originalText);
    }
};
// base64解码为utf8文本，解码失败则返回null
function tryBase64ToUtf8(base64) {
    try {
        let binStr = atob(base64);
        let uint8 = new Uint8Array(binStr.length);
        for (let i = 0; i < binStr.length; i++) {
            uint8[i] = binStr.charCodeAt(i);
        }
        return new TextDecoder().decode(uint8);
    } catch (e) {
        return null;
    }
}
// 01串转为文本
function binToText(binStr) {
    binStr = binStr.replace(/\s+/g, '');
    if (binStr.length % 8 !== 0) return '';
    let bytes = [];
    for (let i = 0; i < binStr.length; i += 8) {
        bytes.push(parseInt(binStr.substr(i, 8), 2));
    }
    return new TextDecoder().decode(new Uint8Array(bytes));
}
</script>
