---
layout: default
title: çŒ«çŒ«å¤´ç¿»è¯‘ç»„æ–‡åº“
header_title: çŒ«çŒ«å¤´ç¿»è¯‘ç»„ - åœ¨çº¿æ–‡æ¡£
header_description: è‡ªåŠ¨ä» Google Drive åŠ è½½ DnD / CoC ç­‰æ–‡æ¡£ï¼Œåœ¨çº¿æµè§ˆ
permalink: /pdf/pdf.html
---

<div class="drive-explorer-container">
  <div class="drive-explorer-sidebar">
    <h2>ğŸ“ æ–‡æ¡£ç›®å½•ï¼ˆGoogle Driveï¼‰</h2>
    <p class="drive-tip">æ•°æ®æ¥æºï¼šGoogle Drive æ–‡ä»¶å¤¹ç»“æ„ï¼ˆdnd / coc ç­‰å­æ–‡ä»¶å¤¹ä¼šè‡ªåŠ¨å±•å¼€ï¼‰</p>
    <div id="driveTree" class="drive-tree">
      <p class="drive-loading">æ­£åœ¨ä» Google Drive åŠ è½½ç›®å½•...</p>
    </div>
  </div>

  <div class="drive-explorer-main">
    <div class="drive-viewer-header">
      <div>
        <div id="currentFileName" class="drive-current-file">è¯·é€‰æ‹©å·¦ä¾§æ–‡ä»¶è¿›è¡Œé¢„è§ˆ</div>
        <div id="currentFilePath" class="drive-current-path"></div>
      </div>
      <div class="drive-viewer-actions">
        <a id="openInDrive" href="#" target="_blank" rel="noopener" class="drive-btn" style="display:none;">
          åœ¨ Google Drive ä¸­æ‰“å¼€
        </a>
      </div>
    </div>

    <div class="drive-viewer-body">
      <iframe id="filePreviewFrame" src="" frameborder="0" class="drive-preview-frame" style="display:none;"></iframe>
      <div id="filePreviewFallback" class="drive-preview-fallback">
        <p>ğŸ‘ˆ åœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé¢„è§ˆã€‚</p>
        <p class="small">æ”¯æŒ PDF / å›¾ç‰‡ / doc / docx / xls / ppt / txt ç­‰ï¼Œåªè¦ Drive å¯ä»¥é¢„è§ˆï¼Œè¿™é‡Œå°±å¯ä»¥å†…åµŒã€‚</p>
      </div>
    </div>
  </div>
</div>

<style>
.drive-explorer-container {
  display: grid;
  grid-template-columns: 280px minmax(0, 1fr);
  gap: 20px;
  padding: 10px 0;
  min-height: 70vh;
}

/* å·¦ä¾§æ ‘å½¢ç›®å½• */
.drive-explorer-sidebar {
  background: rgba(0,0,0,0.25);
  border-radius: 12px;
  padding: 15px;
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  overflow: auto;
  max-height: 80vh;
}

.drive-explorer-sidebar h2 {
  font-size: 1.1rem;
  margin: 0 0 5px;
  color: #fff;
}

.drive-tip {
  font-size: 0.8rem;
  color: #ccc;
  margin-bottom: 10px;
}

.drive-tree {
  font-size: 0.9rem;
  color: #eee;
}

.drive-loading {
  font-size: 0.85rem;
  color: #ddd;
}

.drive-tree ul {
  list-style: none;
  margin: 0;
  padding-left: 14px;
}

.drive-node {
  margin: 2px 0;
}

.drive-node-row {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  padding: 3px 4px;
  border-radius: 6px;
}

.drive-node-row:hover {
  background: rgba(255,255,255,0.06);
}

.drive-node-row.folder-label {
  font-weight: 600;
}

.drive-node-row .chevron {
  width: 14px;
  text-align: center;
  font-size: 0.7rem;
  opacity: 0.8;
}

.drive-node-row .icon {
  font-size: 0.9rem;
  width: 18px;
  text-align: center;
}

.drive-node-row .name {
  flex: 1;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

.drive-node-row.active {
  background: rgba(76,175,80,0.25);
}

/* å³ä¾§é¢„è§ˆåŒº */
.drive-explorer-main {
  background: rgba(0,0,0,0.25);
  border-radius: 12px;
  padding: 15px;
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  min-height: 70vh;
}

.drive-viewer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  gap: 10px;
}

.drive-current-file {
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
}

.drive-current-path {
  font-size: 0.8rem;
  color: #ccc;
}

.drive-viewer-actions {
  display: flex;
  gap: 8px;
}

.drive-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 0.85rem;
  color: #fff;
  background: linear-gradient(45deg, #2196F3, #1976D2);
  border: none;
  cursor: pointer;
  text-decoration: none;
}

.drive-btn:hover {
  filter: brightness(1.1);
}

.drive-viewer-body {
  flex: 1;
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  background: rgba(0,0,0,0.35);
  margin-top: 5px;
}

.drive-preview-frame {
  width: 100%;
  height: calc(80vh - 90px);
  border: none;
}

.drive-preview-fallback {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #eee;
  text-align: center;
  padding: 20px;
}

.drive-preview-fallback .small {
  font-size: 0.8rem;
  color: #ccc;
}

@media (max-width: 900px) {
  .drive-explorer-container {
    grid-template-columns: 1fr;
  }
  .drive-explorer-sidebar {
    max-height: 40vh;
  }
  .drive-preview-frame {
    height: 60vh;
  }
}
</style>

<!-- Google API JS -->
<script src="https://apis.google.com/js/api.js"></script>
<script>
(function() {
  // === ä½ éœ€è¦æ›¿æ¢çš„ä¸¤ä¸ªé…ç½® ===
  const API_KEY = 'AIzaSyCMkQj7OgwdXB5DutdFZmj2plixl-PElZA';   // <- æ¢æˆä½ è‡ªå·±çš„ API Key
  const ROOT_FOLDER_ID = '1KjVi0JTbIOBvls0Z-BjkPWy4d3FTpryi'; // ä½ çš„ Drive æ ¹ç›®å½•ï¼ˆå« dnd / cocï¼‰

  // === ä¸€äº› DOM å¼•ç”¨ ===
  const treeContainer = document.getElementById('driveTree');
  const previewFrame = document.getElementById('filePreviewFrame');
  const previewFallback = document.getElementById('filePreviewFallback');
  const currentFileNameEl = document.getElementById('currentFileName');
  const currentFilePathEl = document.getElementById('currentFilePath');
  const openInDriveLink = document.getElementById('openInDrive');

  let currentActiveRow = null;

  // ä¸€ä¸ªç®€å•çš„æ ‘èŠ‚ç‚¹ç»“æ„
  function createNode(item, parentPath) {
    const isFolder = item.mimeType === 'application/vnd.google-apps.folder';
    const node = {
      id: item.id,
      name: item.name,
      mimeType: item.mimeType,
      webViewLink: item.webViewLink || null,
      children: [],
      isFolder,
      path: parentPath ? parentPath + ' / ' + item.name : item.name
    };
    return node;
  }

  // è°ƒ Drive API åˆ—å‡ºæŸä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰å­é¡¹
  async function listChildren(folderId) {
    const result = [];
    let pageToken = null;
    do {
      const res = await gapi.client.drive.files.list({
        q: `'${folderId}' in parents and trashed = false`,
        pageSize: 1000,
        fields: 'nextPageToken, files(id, name, mimeType, parents, webViewLink)',
        pageToken
      });
      const files = res.result.files || [];
      result.push(...files);
      pageToken = res.result.nextPageToken;
    } while (pageToken);
    return result;
  }

  // é€’å½’æ„å»ºæ ‘
  async function buildTree(folderId, parentPath) {
    const items = await listChildren(folderId);
    const folders = items.filter(f => f.mimeType === 'application/vnd.google-apps.folder')
                        .sort((a, b) => a.name.localeCompare(b.name, 'zh-Hans-CN'));
    const files   = items.filter(f => f.mimeType !== 'application/vnd.google-apps.folder')
                        .sort((a, b) => a.name.localeCompare(b.name, 'zh-Hans-CN'));

    const nodes = [];
    for (const folder of folders) {
      const node = createNode(folder, parentPath);
      node.children = await buildTree(folder.id, node.path);
      nodes.push(node);
    }
    for (const f of files) {
      const node = createNode(f, parentPath);
      nodes.push(node);
    }
    return nodes;
  }

  // æ¸²æŸ“æ ‘åˆ° DOM
  function renderTree(nodes, container) {
    const ul = document.createElement('ul');
    nodes.forEach(node => {
      const li = document.createElement('li');
      li.className = 'drive-node';

      const row = document.createElement('div');
      row.className = 'drive-node-row';
      if (node.isFolder) {
        row.classList.add('folder-label');
      }

      const chevron = document.createElement('span');
      chevron.className = 'chevron';
      chevron.textContent = node.isFolder ? 'â–¸' : '';
      row.appendChild(chevron);

      const icon = document.createElement('span');
      icon.className = 'icon';
      icon.textContent = node.isFolder ? 'ğŸ“' : 'ğŸ“„';
      row.appendChild(icon);

      const name = document.createElement('span');
      name.className = 'name';
      name.textContent = node.name;
      row.appendChild(name);

      li.appendChild(row);

      if (node.isFolder && node.children && node.children.length > 0) {
        const childUl = renderTree(node.children, null);
        childUl.style.display = 'none';
        li.appendChild(childUl);

        // ç‚¹å‡»æ–‡ä»¶å¤¹ï¼ŒæŠ˜å /å±•å¼€
        row.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = childUl.style.display !== 'none';
          childUl.style.display = isOpen ? 'none' : 'block';
          chevron.textContent = isOpen ? 'â–¸' : 'â–¾';
        });
      } else if (node.isFolder && (!node.children || node.children.length === 0)) {
        // ç©ºæ–‡ä»¶å¤¹
        row.addEventListener('click', (e) => {
          e.stopPropagation();
          chevron.textContent = chevron.textContent === 'â–¸' ? 'â–¾' : 'â–¸';
        });
      }

      // æ–‡ä»¶ç‚¹å‡»ï¼šåœ¨å³ä¾§é¢„è§ˆ
      if (!node.isFolder) {
        row.addEventListener('click', (e) => {
          e.stopPropagation();
          openFile(node, row);
        });
      }

      ul.appendChild(li);
    });

    if (container) {
      container.innerHTML = '';
      container.appendChild(ul);
    }
    return ul;
  }

  // åœ¨å³ä¾§æ‰“å¼€æ–‡ä»¶é¢„è§ˆ
  function openFile(node, rowElement) {
    // é«˜äº®å½“å‰
    if (currentActiveRow) {
      currentActiveRow.classList.remove('active');
    }
    currentActiveRow = rowElement;
    currentActiveRow.classList.add('active');

    currentFileNameEl.textContent = node.name;
    currentFilePathEl.textContent = node.path || node.name;

    // é¢„è§ˆé“¾æ¥ï¼šä¼˜å…ˆä½¿ç”¨ webViewLinkï¼Œå†æ›¿æ¢ä¸º preview
    let viewLink = node.webViewLink || `https://drive.google.com/file/d/${node.id}/view`;
    let previewLink = viewLink.replace('/view', '/preview');

    previewFrame.style.display = 'block';
    previewFallback.style.display = 'none';
    previewFrame.src = previewLink;

    // â€œåœ¨ Drive æ‰“å¼€â€æŒ‰é’®
    openInDriveLink.style.display = 'inline-flex';
    openInDriveLink.href = viewLink;
  }

  // åˆå§‹åŒ– Google API å®¢æˆ·ç«¯
  function initGapiClient() {
    return gapi.client.init({
      apiKey: API_KEY,
      discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
    });
  }

  // ä¸»å…¥å£ï¼šåŠ è½½æ ‘ & æ¸²æŸ“
  async function initDriveExplorer() {
    try {
      if (!treeContainer) return;
      treeContainer.innerHTML = '<p class="drive-loading">æ­£åœ¨ä» Google Drive åŠ è½½ç›®å½•...</p>';

      const rootPath = 'çŒ«çŒ«å¤´ç¿»è¯‘ç»„';
      const rootNode = {
        id: ROOT_FOLDER_ID,
        name: rootPath,
        mimeType: 'application/vnd.google-apps.folder',
        isFolder: true,
        path: rootPath,
        children: await buildTree(ROOT_FOLDER_ID, rootPath)
      };

      renderTree([rootNode], treeContainer);
      treeContainer.querySelector('.drive-loading')?.remove();
    } catch (err) {
      console.error('åŠ è½½ Drive ç›®å½•å¤±è´¥:', err);
      if (treeContainer) {
        treeContainer.innerHTML = '<p style="color:#ffb3b3;font-size:0.85rem;">åŠ è½½ Google Drive ç›®å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Keyã€æ–‡ä»¶å¤¹å…±äº«æƒé™æˆ–ç¨åé‡è¯•ã€‚</p>';
      }
    }
  }

  // åŠ è½½ gapi å¹¶åˆå§‹åŒ–
  function onGapiLoaded() {
    gapi.load('client', async () => {
      try {
        await initGapiClient();
        await initDriveExplorer();
      } catch (err) {
        console.error('åˆå§‹åŒ– GAPI å®¢æˆ·ç«¯å¤±è´¥:', err);
        if (treeContainer) {
          treeContainer.innerHTML = '<p style="color:#ffb3b3;font-size:0.85rem;">åˆå§‹åŒ– Google API å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API é…ç½®ã€‚</p>';
        }
      }
    });
  }

  // gapi è„šæœ¬åŠ è½½å®Œæˆåæ‰§è¡Œ
  if (window.gapi && gapi.load) {
    onGapiLoaded();
  } else {
    window.addEventListener('load', () => {
      if (window.gapi && gapi.load) {
        onGapiLoaded();
      }
    });
  }
})();
</script>
